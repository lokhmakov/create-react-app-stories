import { genSalt, hash }    from 'bcryptjs'
import svgCaptcha           from 'svg-captcha'

import debug                from '../debug'

export default async (parent, payload, ctx) => {
  debug(`makeMath()`)
  try {
    const { text, data } = svgCaptcha.createMathExpr()
    const salt = await genSalt(10)
    const encryptedText = await hash(text, salt)

    return JSON.stringify({
      text: encryptedText,
      data,
    })
  } catch (err) {
    return null
  }
}
