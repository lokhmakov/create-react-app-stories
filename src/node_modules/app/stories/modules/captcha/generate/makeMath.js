import { graphql }          from 'react-apollo'

import generateQueryMakeMath from './query/makeMath'

export default ({ config, debug, methods }) => (payload) => {
  const { options = {} } = payload || {}
  return graphql(generateQueryMakeMath(config), {
    options,
    props: ({ data }) => {
      // debug(`graphql.currentUser.query()`, `RESULT`)

      const { captchaMakeMath, refetch } = data

      if (captchaMakeMath) {
        try {
          const result = JSON.parse(captchaMakeMath)
          return {
            captchaData: result.data,
            captchaText: result.text,
            captchaRefetch: refetch,
          }
        } catch (err) {
          return null
        }
      }

      return {}
    },
  })}

