import config               from '../config'
import debug                from '../debug'
import model                from '../model'

const { tokenName } = config

export default async (parent, payload, ctx) => {
  debug(`logout()`, payload)
  try {
    if (ctx && ctx.res) ctx.res.cookie(tokenName, '', { expires: new Date() })

    const {
      sessionId = ctx && ctx.req && ctx.req.cookies[tokenName]
    } = payload

    if (!sessionId) return false
    return {
      result: await model.destroy({ where: { id: sessionId }}),
      errors: []
    }
  } catch (err) {
    debug(`logout()`, `ERROR`, err)
    return {
      result: null,
      errors: [
        { message: err.message },
      ]
    }
  }
}
