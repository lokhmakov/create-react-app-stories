import { graphql }          from 'react-apollo'

import generateQueryLogin   from './query/login'

export default ({ config, debug, methods }) => (payload) => {
  const updateQueries = {
    sessionCurrentUser: (prev, { mutationResult }) => {
      const { data } = mutationResult
      const { sessionLogin = {} } = data
      const { result } = sessionLogin
      if (!result) return prev

      const { User } = result
      return { sessionCurrentUser: User }
    }
  }

  return graphql(generateQueryLogin(config), {
    props: ({ mutate }) => ({
      sessionLogin: (variables) => {
        return mutate({
          variables,
          updateQueries,
        })
      }
    })
  })
}
