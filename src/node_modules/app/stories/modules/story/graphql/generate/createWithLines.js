import { graphql }          from 'react-apollo'

import generateGraphqlText  from './query/createWithLines'

export default ({ config, debug, methods }) => (payload) => {
  const updateQueries = {
    messageDataOwn: (prev, { mutationResult }) => {
      debug(`graphql.storyCreateWithLines.updateQueries()`)

      const { data = {} } = mutationResult
      const { storyCreateWithLinesw: createResult } = data
      const { result: [doc] } = createResult

      return {
        messageDataOwn: [
          ...prev.messageDataOwn,
          doc,
        ]
      }
    },
  }

  return graphql(generateGraphqlText(config), {
    props: ({ mutate }) => ({
      storyCreateWithLines: (variables) => {
        return mutate({
          variables,
          updateQueries,
        })
      }
    })
  })
}
