import model                from '../model'

import validateEmail        from './validateEmail'
import createPassword       from './createPassword'

export default async (payload) => {
  try {
    const { username, password, accessLevel = 0 } = payload

    if (!validateEmail(username)) throw new Error(`Username invalid`)

    if (await model.findOne({ where: { username }})) throw new Error(`User already exist`)

    return model.create({
      username,
      password: await createPassword({ password }),
      accessLevel,
    })
  } catch (err) {
    throw err
  }
}
