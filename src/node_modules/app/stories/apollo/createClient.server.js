import { createLocalInterface } from 'apollo-local-query'

import createApolloClient   from 'engine/apollo/createApolloClient'

import getSchema            from '../graphql/getSchema'

export default function createServerClient(payload) {
  const { req, res } = payload

  const schema = getSchema()

  const networkInterface = createLocalInterface(require('graphql'), schema, {
    context: {
      req,
      res,
    }
  })

  return createApolloClient({
    dataIdFromObject: result => {
      return result.id || null
    },
    networkInterface: networkInterface,
    ssrForceFetchDelay: 100,
  })
}
