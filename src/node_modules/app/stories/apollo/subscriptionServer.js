import { createServer }     from 'http'
import { SubscriptionServer } from 'subscriptions-transport-ws'

import subscriptionManager  from './subscriptionManager'

import config               from '../config'

const state = {

}

export default function start() {
  const server = createServer((req, res) => {
    res.writeHead(404)
    res.end()
  })

  server.listen(config.subscriptionPort, `0.0.0.0`, () => console.log(
    `${ config.name } Websocket Server is now running on wss://0.0.0.0:${ config.subscriptionPort }`
  ));

  state.subscriptionServer = new SubscriptionServer(
    {
      keepAlive: 20000,
      onConnect: async (connectionParams) => {
        console.log(`${ config.name } SUBSCRIPTION CLIENT - CONNECTED`)
      },
      subscriptionManager: subscriptionManager
    },
    {
      server: server,
      path: '/'
    }
  )
}
