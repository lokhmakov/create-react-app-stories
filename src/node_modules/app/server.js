import start                from 'engine/server'
import middlewareGraphQL    from 'engine/server/graphql'

import getSchema            from 'app/stories/graphql/getSchema'
import preload              from './preload'

import sessionStories       from 'app/stories/modules/session/middleware/sessionMiddleware'

async function main() {
  try {
    await preload()
  } catch (err) {
    console.log(err)
  }

  try {
    const schema = getSchema()

    await start({
      middlewareList: [
        sessionStories(),
        middlewareGraphQL({ schema }),
      ],
    })
  } catch (err) {
    console.log(err)
  }
}

main()
