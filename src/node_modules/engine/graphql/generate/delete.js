import debug                from '../debug'

export default ({ customResolverMap, model, name, pubsub }) =>  async (parent, payload, ctx) => {
  try {
    debug(`${ name }Delete()`, payload)

    if (customResolverMap['delete']) return customResolverMap['delete'](parent, payload, ctx)

    const { where } = payload
    const { id } = where

    const result = await model.destroy({ where })

    pubsub.publish(`${ name }Deleted`, where.id)

    if (result) return { result: id, errors: [] }
    return { errors: [] }
  } catch (err) {
    debug(`${ name }Delete()`, `ERROR`, err)
    return { errors: [
      { message: err }
    ]}
  }
}
