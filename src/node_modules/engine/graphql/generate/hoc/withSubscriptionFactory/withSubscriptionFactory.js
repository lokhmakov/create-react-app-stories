import React                from 'react'

export default (mapPropsToSubscribeToMore, subscriptionDoc) => (WrappedComponent) => {
  return class SubscriptionProvider extends React.Component {
    componentWillReceiveProps(nextProps) {
      if (!this.subscription) {
        const subscribeToMore = mapPropsToSubscribeToMore(nextProps)
        this.subscription = subscribeToMore(subscriptionDoc)
      }
    }

    render() {
      return (
        <WrappedComponent
          { ...this.props }
        />
      )
    }
  }
}
