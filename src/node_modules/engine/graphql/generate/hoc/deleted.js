import { filter }           from 'lodash'

import generateQueryDeleted from 'engine/graphql/generate/query/deleted'

export default ({ config, debug, methods }) => ({
  document: generateQueryDeleted(config),
  updateQuery: (prev, { subscriptionData }) => {
    debug(`graphql.updated.updateQuery()`)

    const { data = {}} = subscriptionData
    const { [methods.deleted ]: id } = data

    return {
      [methods.findAll]: {
        result: filter(prev[methods.findAll].result, doc => doc.id !== id ),
        errors: prev[methods.findAll].errors,
      }
    }
  },
})
