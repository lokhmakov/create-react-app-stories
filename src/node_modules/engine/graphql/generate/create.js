import { map }              from 'lodash'

import debug                from '../debug'

export default ({ customResolverMap, model, name, pubsub }) => async (parent, payload, ctx) => {
  debug(`${ name }Create()`, payload)

  const { create } = customResolverMap
  if (create) return create(parent, payload, ctx)

  const { where, defaults } = payload

  if (where) {
    const [result, created] = await model.findOrCreate({ where, defaults })
    pubsub.publish(`${ name }Created`, result)
    return { result: [result], errors: [] }
  }

  const result = await model.create(defaults)
  pubsub.publish(`${ name }Created`, result)
  return { result: [result], errors: [] }
}
