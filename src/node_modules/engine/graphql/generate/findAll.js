import { map }              from 'lodash'


import debug                from '../debug'

export default ({ customResolverMap, model, name }) => async (parent, payload, ctx) => {
  debug(`${ name }FindAll()`, payload)

  const { findAll } = customResolverMap
  if (findAll) return findAll(parent, payload, ctx)

  const { where, limit = 50, offset = 0, order } = payload

  const result = await model.findAll({
    where,
    limit,
    offset,
    order: order ? map(order, ({ name, order }) => [name, order]) : [],
  })

  return { result, errors: [] }
}
