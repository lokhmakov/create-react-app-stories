import _                    from 'lodash'

export default function generateReference({ fieldDoc, model, models }) {
  const { name, type, allowNull = true } = fieldDoc
  if (models[type]) {
    const destinationModel = models[type]
    const foreignName = _.lowerFirst(name)
    model.belongsTo(destinationModel, {
      as: name,
      foreignKey: {
        name: `${ foreignName }Id`,
        allowNull,
      },
    })
  } else {
    throw new Error(`Reference model ${ name } : ${ type } undefined`)
  }
}
